/*
?("websockets".in(sys.modules),{println("websockets supported")},{println("websockets not supported");sys.exit(1)},0);

http_call={
	println("serving request:[",arguments["message"],"] : ",arguments["protocol"]);
	ret="Hallo Welt!:"+arguments["protocol"];
};
*/

running = 1;

/*sessions = [];*/

echo_call={
	/*println("serving request:[",arguments["message"],"] : ",arguments["protocol"]);*/
	running = 0;
	println("timestamp:",sys.time);
	ret="Hallo:"+sys.time+":"+arguments["protocol"]+" id:"+arguments["session_id"]+" time_stamp:"+sys.time;
	/*ret="timestamp:"+sys.time;*/
};

println("starting daemon");
/*cbs=["echo":echo_call];
daemon=websockets.start(8080,cbs);*/
timeout=10;
daemon=websockets.start(8080,["echo":echo_call]);
println("servicing");
?({running},{daemon.service(timeout)},{println("stopping daemon");daemon.service(1000);daemon.stop()},1);
/*??({daemon=websockets.start(8080,["echo":echo_call])},{running},{daemon.service(10)},{println("stopping daemon");daemon.service(1000);daemon.stop()},1);*/
println("stopped daemon");

