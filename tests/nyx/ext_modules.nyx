?("marshal".in(sys.modules),{println("marshal supported")},{println("marshal not supported");sys.exit(1)},0);
println("joystick:","joystick".in_keys(sys.modules));
joysticks = marshal.open_module("./nyx/modules/libjoy/nyxmod_libjoy.so");
println("Found "+joysticks.num+" Joysticks");
println("Ordered mode:"+joysticks.ordered_mode);
/*joysticks.ordered_mode = 1;
println("Ordered mode:"+joysticks.ordered_mode);*/

/*joysticks.ordered_mode = 0;
println("Ordered mode:"+joysticks.ordered_mode);
println(joysticks.ANY);*/

/*joystick=joysticks.open(0,joysticks.NON_BLOCKING);*/
/*joystick=joysticks.open("/dev/input/js0",joysticks.NON_BLOCKING);*/
joystick=joysticks.open(0,joysticks.BLOCKING);
println("Joystick Name:"+joystick.name);
println("Joystick Axes Num:"+joystick.axes_num);
println("Joystick Buttons Num:"+joystick.buttons_num);
running=0;
?({running==0},
{
	event=joystick.get_event();
	event.do({
		println("time:"+event.time);
		println("type:"+event.type);
		println("value:"+event.value);
		println("number:"+event.number);
		(event.type==1).do({println("button "+event.number+" pressed ");@running++;});
		});
	println("run:"+running);
},{},1);

println("running:"+running);

joystick.close();

marshal.close_module(joysticks);

